# tugical (ツギカル) Development Rules
# LINE連携型予約管理SaaS

## 🎯 プロジェクト概要
- **サービス**: tugical - 汎用時間貸しリソース予約システム
- **コンセプト**: "次の時間が、もっと自由になる。"
- **統一概念**: 予約 = リソース × 時間枠 × メニュー（複数組み合わせ対応）
- **対応業種**: 5分〜480分の任意時間ベース予約業務（医療・美容・施設・教育・アクティビティ）
- **技術スタック**: Laravel + React + Vite + LINE API + MariaDB + Docker

## 📚 仕様書索引（必須確認）

### 最新仕様書一覧
**実装前には該当する仕様書を必ず確認してください：**

1. **システム仕様書 v2.2** (`docs/仕様書/tugical_system_specification_v2.0.md`)
   - 全体アーキテクチャ、複数メニュー組み合わせ、電話予約最適化
   - 業種別UI最適化、汎用時間スロット設定システム

2. **データベース設計書 v1.2** (`docs/仕様書/tugical_database_design_v1.0.md`)
   - テーブル定義、booking_details設計、マルチテナント構造
   - 時間スロット設定、業種別属性、外部キー制約

3. **API仕様書 v1.2** (`docs/仕様書/tugical_api_specification_v1.0.md`)
   - RESTful API仕様、複数メニュー予約API、電話予約最適化API
   - エラーハンドリング、認証、レスポンス形式

4. **要件定義書 v1.1** (`docs/仕様書/tugical_requirements_specification_v1.0.md`)
   - ビジネス要件、機能要件、非機能要件

5. **UI/UX設計書 v1.0** (`docs/仕様書/tugical_ui_design_system_v1.0.md`)
   - デザインシステム、コンポーネント仕様、レスポンシブ対応

6. **テスト戦略書 v1.0** (`docs/仕様書/tugical_test_strategy_v1.0.md`)
   - テスト方針、カバレッジ要件、E2Eテスト

7. **デプロイメント書 v1.0** (`docs/仕様書/tugical_deployment_guide_v1.0.md`)
   - VPS運用、環境構築、CI/CD

## 🔒 絶対遵守ルール（CRITICAL）

### 1. マルチテナント セキュリティ
- **store_id分離**: 全テーブルでstore_id必須
- **TenantScope**: 自動店舗フィルタリング実装
- **クロステナントアクセス**: 絶対禁止（セキュリティ違反）

### 2. 仕様書厳守
- **実装前確認**: 必ず該当する仕様書を確認
- **仕様書優先**: .cursorrulesと矛盾時は仕様書を優先
- **バージョン確認**: 最新バージョンの仕様書を使用

### 3. 開発フロー
- **ブランチ**: developブランチで開発
- **コミット**: 日本語メッセージ必須
- **進捗管理**: PROGRESS.md必須更新
- **メモリー活用**: 重要発見時はupdate_memoryツール使用

## 🏗️ アーキテクチャ指針

### Backend（Laravel）
- Laravel 10+ + PHP 8.2+
- PSR-12準拠
- マルチテナント対応
- API Resources使用
- 適切なエラーハンドリング

### Frontend（React + TypeScript）
- 関数コンポーネント + hooks
- Tailwind CSS（tugicalデザインシステム準拠）
- Framer Motion（アニメーション）
- モバイルファースト設計

### Database（MariaDB）
- snake_case命名
- 適切な外部キー制約
- JSON列活用
- インデックス最適化

## 📱 LIFF開発注意事項
- localStorage制限：React state + sessionStorage併用
- LINE SDK適切な実装
- 5ステップ予約フロー
- 10分仮押さえシステム

## 🎨 UI/UX要件
- **パフォーマンス**: LIFF 2秒以内、管理画面 1秒以内
- **タッチターゲット**: 最小44px以上
- **片手操作**: 電話予約時の片手操作対応
- **アクセシビリティ**: 業種別表示名対応

## 🔍 実装時チェックリスト

### 開発開始前
- [ ] 該当する仕様書を確認
- [ ] developブランチにいることを確認
- [ ] git pull origin develop実行

### 実装中
- [ ] マルチテナント対応（store_id分離）
- [ ] 仕様書に沿った実装
- [ ] 適切なエラーハンドリング
- [ ] 日本語コメント追加

### 完了後
- [ ] PROGRESS.md更新
- [ ] 日本語コミットメッセージ
- [ ] develop branchにpush
- [ ] 必要に応じてメモリー更新

## 📊 進捗管理
- **ファイル**: `docs/PROGRESS.md`
- **更新タイミング**: 作業完了時必須
- **記載内容**: 日時、変更ファイル、コミットハッシュ、次回予定

## 🤖 AI開発指示
1. **仕様書確認**: 実装前に必ず関連仕様書を確認
2. **完全実装**: TODOや部分実装は禁止
3. **日本語コメント**: 全関数・クラスにコメント必須
4. **エラーハンドリング**: 適切な例外処理とユーザーメッセージ
5. **パフォーマンス**: 2-3秒の応答時間目標

## 🚨 重要な注意事項
- **重要変更**: 必ずユーザー事前確認
- **不明点**: 積極的に質問して解消
- **透明性**: 進捗・問題の随時報告
- **現実重視**: 実際のユースケース優先

---

**AI駆動開発プロジェクト**: 仕様書からズレた実装は絶対禁止
**現在の開発状況**: Phase 22完了（複数メニュー組み合わせ・電話予約最適化設計完了）
**次の実装**: booking_detailsテーブル実装 → 複数メニュー組み合わせシステム

#############################################
# tugilo標準（開発基盤ルール）
#############################################

### 作業開始前に読むファイル強制
- `docs/process/README.md`
- 当該Phaseの PLAN（`docs/process/phases/`）
- 関連仕様書（`docs/仕様書/`）

### テンプレ非準拠作業禁止
- `docs/process/templates/` のテンプレートに準拠すること

### SSOT優先順位固定
1) 既存設計/仕様 2) Phase PLAN 3) 既存実装 4) 新提案（提案止まり）

### スコープロック強制
- 対象/対象外宣言をPhase開始時に必須
- 途中追加は理由・影響・最小化を文書化

### 未依頼リファクタ禁止
- ユーザー依頼なくリファクタ・方式変更を行わない

### 方式変更はPLAN先行必須
- 新方式への変更はPLANに記載・承認後に実施

### トラック混在禁止
- 並行ラインがある場合、命名で明確に区別

### 1pushルール
- 1Phase = 1push
- push前に `git diff --name-only` を記録

### コード変更時テスト/ビルド必須
- `php artisan test` / `npm run build` 等を実行
- 失敗時はpush禁止

### 新規機能は必ず feature ブランチで開発
- `develop` から `feature/<name>` を作成

### feature→main直マージ禁止
- 必ず develop 経由で main へマージ