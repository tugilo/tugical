---
marp: true
theme: default
size: 16:9
paginate: true
header: "tugical 要件定義書"
footer: "© tugilo inc. all rights reserved"
---

# tugical（ツギカル）要件定義書
## LINE連携型予約管理SaaS

**Version**: 1.0  
**Date**: 2025年6月28日  
**Author**: tugilo inc.

---

## 目次

1. **プロジェクト概要**
2. **機能要件**
3. **非機能要件**
4. **データベース設計**
5. **API設計**
6. **UI/UX設計**
7. **プラン・料金体系**

---

## 1. プロジェクト概要

### サービス概要
- **サービス名**: tugical（ツギカル）
- **スローガン**: 次の時間が、もっと自由になる。
- **形態**: LINE連携型予約管理SaaS
- **コンセプト**: 時間貸しリソース予約システム

### 技術構成
| 要素 | 技術 |
|------|------|
| バックエンド | Laravel + MariaDB |
| フロントエンド | React + Next.js |
| UI/UX | Tailwind CSS + Framer Motion |
| 外部連携 | LINE Messaging API + LIFF |
| ホスティング | さくらクラウド + GitHub Actions |

---

## 2. 対象業種・ユースケース

### 統一概念：時間貸しリソース予約
```
予約 = リソース × 時間枠 × メニュー
```

| 業種 | リソース | 時間単位 | 特徴 |
|------|----------|----------|------|
| 美容・ネイル | スタッフ | 30-120分 | 指名制・技能差 |
| 整体・施術 | 施術者 | 30-90分 | 繰り返し予約 |
| レンタルスペース | 部屋・設備 | 1時間-1日 | 収容人数・設備 |
| 教室・スクール | 講師・教室 | 60-120分 | 定期予約・代理予約 |
| アクティビティ | インストラクター | 2-8時間 | 定員制・条件制限 |

---

## 3. プラン・料金体系

### プラン構成

| プラン | 月額料金 | 店舗数 | 主要機能 |
|--------|----------|--------|----------|
| **フリー** | ¥0 | 1店舗 | 月50件予約、基本機能のみ |
| **スタンダード** | ¥3,000 | 1店舗 | 無制限予約、全機能 |
| **プロ** | ¥8,000 | 最大3店舗 | 多店舗管理、高度分析 |
| **エンタープライズ** | ¥15,000～ | 無制限 | API連携、専任サポート |

### オプション機能（有料）
- 決済連携：¥1,000/月
- 初期設定代行：¥30,000/回
- カスタムデザイン：¥50,000/回

---

## 4. 機能要件 - 顧客側（LIFF）

### 予約フロー
1. **LIFF起動・認証**
   - LINE経由でUUID自動取得
   - 初回：基本情報入力、リピーター：情報確認

2. **メニュー選択**
   - カテゴリ別表示
   - 料金・所要時間・詳細説明（モーダル）
   - 税込/税抜表示（管理者設定）

3. **リソース選択（スタッフ・部屋等）**
   - 指名あり/なし選択
   - 専門分野・料金差表示
   - おまかせ（自動割当）オプション

---

## 4. 機能要件 - 顧客側（LIFF）続き

4. **日時選択**
   - **自動承認店舗**: 空き時間から即時確定
   - **手動承認店舗**: 第3希望まで選択
   - **仮押さえシステム**: 選択時に10分間仮予約

5. **個人情報入力**
   - 管理レベル選択可能（ライト/スタンダード/詳細）
   - アレルギー・要望事項
   - 利用規約同意

6. **最終確認・予約確定**
   - 予約内容確認
   - キャンセル規定表示
   - 仮押さえトークンでの安全な確定

---

## 4. 機能要件 - 顧客側（LIFF）その他

### マイページ機能
- 予約履歴確認
- 予約変更依頼（承認制）
- 個人情報更新
- 通知設定変更

### UX特徴
- **離脱時保存**: ステップ途中で離脱してもデータ保持
- **戻るボタン**: 各ステップ間の自由な移動
- **リアルタイム更新**: 予約状況のライブ反映
- **直感的操作**: ドラッグ&ドロップ、タップ中心

---

## 5. 機能要件 - 管理者側

### 予約管理
- **表示形式**: カレンダー・リスト・スタッフ別・リソース別
- **基本操作**: 承認・却下・変更・キャンセル・手動追加
- **ドラッグ&ドロップ**: 時間・担当者・日付変更
- **同時アクセス制御**: 複数スタッフでの安全な操作
- **操作ログ**: 全変更履歴の記録

### リソース管理（汎用）
- **タイプ**: スタッフ/部屋/設備/車両等
- **属性設定**: 専門分野・料金差・制約条件
- **稼働時間**: 個別スケジュール・効率率設定
- **業種別表示名**: 「スタッフ」「講師」「部屋」等

---

## 5. 機能要件 - 管理者側 続き

### メニュー管理
- **基本設定**: 名称・説明・料金・標準時間
- **バッファ時間**: 事前準備・事後片付け時間
- **リソース対応**: メニュー別利用可能リソース
- **オプション**: 追加サービス・料金設定

### 顧客管理
- **基本情報**: LINE情報・手動入力項目
- **履歴管理**: 予約・キャンセル・利用状況
- **ランク管理**: 自動/手動でのVIP設定
- **制限機能**: 無断キャンセル対策・予約制限
- **顧客マッチング機能**: 手動登録顧客とLINE連携の統合
  - 電話番号ベースの既存顧客検索
  - 本人確認（SMS/メール確認コード）
  - スタッフ承認型マッチング（複数候補時）
  - 重複登録防止・データ統合

---

## 5. 機能要件 - 管理者側 続き

### 営業時間・定休日設定
- **基本営業時間**: 曜日別・複数時間帯対応
- **祝日対応**: 自動祝日判定・個別設定
- **シーズン営業**: 夏季・冬季等の期間別設定
- **スタッフ別稼働時間**: 個別シフト管理

### キャンセル期限・料金設定
- **期限制御**: 時間ベース・メニュー別設定
- **キャンセル料**: 段階的料金・業種別ルール
- **無断キャンセル対策**: 履歴記録・予約制限機能

---

## 5. 機能要件 - 管理者側 続き

### LINE通知機能
- **通知タイミング**: 予約関連・リマインダー・運営情報
- **テンプレート編集**: 業種別デフォルト・自由編集
- **配信制御**: 時間帯制限・頻度制限・顧客別設定
- **動的情報**: 顧客名・予約詳細の自動挿入

### 業種テンプレート
- **パッケージ**: 美容・整体・レンタル・教室・アクティビティ
- **初期設定**: デフォルトメニュー・営業時間・通知文
- **複数業種対応**: 1店舗での併用（美容+ネイル等）
- **段階適用**: そのまま利用/部分変更/フル活用

---

## 5. 機能要件 - 管理者側 続き

### 初期設定機能
- **🚀 かんたんモード**: 対話形式ウィザード・業種テンプレート自動適用
- **⚙️ 詳細モード**: 全項目個別設定・高度機能利用
- **段階成長**: 導入→習熟→拡張の段階的機能開放

### システム管理
- **多店舗管理**: プロプラン以上で複数店舗対応
- **スタッフ権限**: オーナー/マネージャー/スタッフ/受付
- **データ移行**: 他システムからのCSV/API移行支援
- **セキュリティ**: 二段階認証・アクセス制御

---

## 6. 非機能要件

### パフォーマンス要件
| 項目 | 目標値 | 許容値 |
|------|--------|--------|
| LIFF画面表示 | 2秒以内 | 3秒以内 |
| 予約操作完了 | 3秒以内 | 4.5秒以内 |
| 管理画面表示 | 1秒以内 | 1.5秒以内 |
| LINE通知送信 | 10秒以内 | 15秒以内 |

### 可用性要件
- **稼働率**: サービス全体99.5%以上、予約機能99.9%以上
- **メンテナンス**: 定期月1回深夜、緊急は1時間前通知
- **復旧目標**: 軽微30分以内、重大2時間以内

---

## 6. 非機能要件 続き

### セキュリティ要件
- **データ保護**: AES-256暗号化、HTTPS/TLS 1.3
- **個人情報**: GDPR対応、削除権・ポータビリティ
- **認証**: メール+パスワード、二段階認証対応
- **アクセス制御**: RBAC、店舗データ完全分離

### 拡張性要件
- **スケーラビリティ**: 水平・垂直スケーリング対応
- **保守性**: PSR準拠、自動テスト、CI/CD
- **Multi-Tenant**: Single DB、テナントID分離

---

## 7. データベース設計

### 基本方針
- **アーキテクチャ**: Single Database, Multi-Schema
- **分離方式**: テナントIDによる完全分離
- **設計思想**: 汎用リソース予約システム

### 主要テーブル構成
```sql
tenants (事業者)
├ stores (店舗)
├ resources (スタッフ・部屋・設備)
├ menus (サービスメニュー)
├ customers (顧客)
├ bookings (予約)
├ booking_changes (予約変更履歴)
└ notifications (通知履歴)
```

---

## 7. データベース設計 続き

### 重要テーブル詳細

#### bookings (予約)
```sql
bookings
├ id, store_id, customer_id
├ resource_id (担当リソース)
├ menu_id, booking_date
├ start_time, end_time
├ status (pending/confirmed/cancelled/completed)
├ total_price, customer_notes, staff_notes
└ created_at, updated_at
```

#### resources (汎用リソース)
```sql
resources  
├ id, store_id, type (staff/room/equipment)
├ name, description, photo_url
├ attributes (JSON: 専門分野・料金差等)
├ working_hours (JSON), efficiency_rate
└ is_active, created_at, updated_at
```

---

## 8. API設計

### 基本方針
- **RESTful API**: Laravel Sanctum認証
- **レスポンス**: JSON形式、統一エラー処理
- **バージョニング**: /api/v1/
- **レート制限**: プラン別（100-1000req/min）

### 主要エンドポイント

#### 管理者向け
```http
GET    /api/v1/bookings              # 予約一覧
POST   /api/v1/bookings              # 予約作成
PUT    /api/v1/bookings/{id}         # 予約更新
DELETE /api/v1/bookings/{id}         # 予約削除

GET    /api/v1/resources             # リソース一覧
POST   /api/v1/resources             # リソース登録
```

---

## 8. API設計 続き

#### LIFF（顧客向け）
```http
GET  /api/v1/liff/menus                    # メニュー取得
GET  /api/v1/liff/availability             # 空き時間取得
POST /api/v1/liff/hold-slot                # 仮押さえ
POST /api/v1/liff/bookings                 # 予約申込み
GET  /api/v1/liff/bookings/history         # 予約履歴
```

#### リアルタイム機能
- **WebSocket**: 予約状況ライブ更新
- **仮押さえ**: 10分間の排他制御
- **競合回避**: 最終確定時の安全性確保

---

## 9. UI/UX設計

### デザインシステム
- **カラー**: ミントグリーン (#10B981) × ダークグレー (#1F2937)
- **フォント**: Nunito統一
- **アイコン**: t入りカレンダーロゴ
- **アニメーション**: Framer Motion、直感的フィードバック

### レスポンシブ対応
- **Mobile First**: スマホ最適化優先
- **管理画面**: PC/タブレット対応
- **LIFF**: スマホ特化、タップ・スワイプ中心操作

---

## 9. UI/UX設計 続き

### 主要画面構成

#### 管理者ダッシュボード
```
Header: [tugical] [店舗選択] [ユーザー]
Sidebar: 予約管理/顧客管理/設定
Main: 今日の予約/売上/人気メニュー/通知
```

#### LIFF予約フロー
```
Step 1: メニュー選択（カード形式、モーダル詳細）
Step 2: リソース選択（写真付き、料金差表示）
Step 3: 日時選択（カレンダー、仮押さえ表示）
Step 4: 個人情報（最小入力、バリデーション）
Step 5: 確認・完了（要約表示、規約明記）
```

---

## 10. 開発・リリース計画

### MVP機能範囲
- ✅ 基本予約フロー（LIFF + 管理画面）
- ✅ LINE通知連携
- ✅ 業種テンプレート（5業種）
- ✅ 仮押さえシステム
- ✅ リアルタイム更新
- ❌ キャンセル待ち機能（v2以降）
- ❌ 決済連携（オプション対応）

### 削除機能（複雑性回避）
- キャンセル待ち機能全般
- 複雑な予約変更フロー
- 高度な分析・レポート機能

---

## 11. 成功指標・KPI

### 事業指標
- **導入店舗数**: 1年で100店舗
- **アクティブ利用率**: 月次80%以上
- **解約率**: 月次5%以下
- **アップグレード率**: フリー→有料20%

### 技術指標
- **稼働率**: 99.5%維持
- **レスポンス**: 目標値内95%
- **バグ**: 月次報告件数10件以下

### 顧客満足度
- **予約完了率**: 90%以上
- **操作時間**: 3分以内で予約完了
- **リピート率**: 70%以上

---

## 付録：用語定義

| 用語 | 定義 |
|------|------|
| **リソース** | 予約対象（スタッフ・部屋・設備等）の統一概念 |
| **仮押さえ** | 時間選択時の10分間排他制御システム |
| **バッファ時間** | メニュー前後の準備・片付け時間 |
| **効率率** | スタッフの作業時間短縮・延長率 |
| **LIFF** | LINE Front-end Framework |
| **Multi-Tenant** | 複数店舗の単一システム運用方式 |

---

## まとめ

tugicalは「時間貸しリソース予約」という統一概念により、様々な業種に対応可能なLINE連携型SaaSとして設計されています。

**重要な設計思想**：
- シンプルさの追求（キャンセル待ちなし）
- 段階的成長対応（かんたん→詳細モード）
- 現実運用への配慮（バッファ時間・仮押さえ）
- 収益性の確保（プラン設計・オプション機能）

**次のステップ**: 詳細設計・プロトタイプ開発・ユーザーテスト

---

**文書管理**: Version 1.0 - 2025.06.28 初版作成